apply plugin: 'groovy'
apply plugin: 'idea'
apply plugin: 'application'

sourceCompatibility = 1.8
targetCompatibility = 1.8

mainClassName = 'scraper.service.Application'

sourceSets {
    main {
        groovy {
            srcDirs = ['src/main/java']
        }

        java {
            srcDirs = []
        }

        resources {
            srcDirs = ['src/main/resources']
        }
    }
}

repositories {
    mavenCentral()
}

dependencies {
    compile group: 'com.cloudinary', name: 'cloudinary', version: '1.0.2'
    compile group: 'org.springframework.boot', name: 'spring-boot-starter-web', version: '1.5.3.RELEASE'
    compile group: 'org.springframework.boot', name: 'spring-boot-starter-data-rest', version: '1.5.3.RELEASE'
    compile group: 'org.springframework.data', name: 'spring-data-mongodb', version: '1.10.3.RELEASE'
    compile group: 'org.springframework.security', name: 'spring-security-core', version: '4.0.4.RELEASE'
    compile group: 'org.apache.logging.log4j', name: 'log4j-core', version: '2.8.2'
    compile group: 'io.jsonwebtoken', name: 'jjwt', version: '0.7.0'
    compile group: 'org.codehaus.groovy', name: 'groovy-all', version: '2.5.0-alpha-1'
    compile group: 'org.mockito', name: 'mockito-all', version: '2.0.2-beta'
    compile group: 'org.junit', name: 'junit5-engine', version: '5.0.0-ALPHA'
    compile group: 'org.springframework.amqp', name: 'spring-rabbit', version: '1.4.5.RELEASE'
    compile group: 'org.springframework', name: 'spring-websocket', version: '4.3.8.RELEASE'
    compile group: 'org.springframework', name: 'spring-messaging', version: '4.3,8.RELEASE'
    compile group: 'org.springframework.security', name: 'spring-security-core', version: '4.2.2.RELEASE'
    compile group: 'org.springframework.security', name: 'spring-security-config', version: '4.2.2.RELEASE'
    compile group: 'org.springframework.security', name: 'spring-security-web', version: '4.2.2.RELEASE'

    compile project(':scraper-core')
    // git clone https://github.com/sergeytkachenko/scraper-core.git scraper-core
}

version = '1.0'

jar {
    baseName = 'scraper-service'
    from {
        configurations.compile.collect {
            it.isDirectory() ? it : zipTree(it)
        }
        configurations.runtime.collect {
            it.isDirectory() ? it : zipTree(it)
        }
    }
    manifest {
        attributes (
            "Manifest-Version": "1.0",
            'Class-Path': configurations.compile.collect { it.getName() }.join(' '),
            'Main-Class': 'scraper.service.Application'
        )
    }
}
